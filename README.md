# 网络设备的区别

为了更好的理解多种网络设备的功能及其区别，创建此开源项目，从而帮助大家和技术人员，更深刻的理解、应用和部署网络设备。

希望能够汲取大家智慧，欢迎大家共同完善此项目，有想法或发现Bug请提issue。

**目录**
<!-- TOC -->

- [网络设备的区别](#网络设备的区别)
    - [常规网络设备](#常规网络设备)
        - [网卡](#网卡)
            - [网卡的定义](#网卡的定义)
            - [网卡的功能](#网卡的功能)
            - [网卡的Q&A](#网卡的qa)
        - [网桥](#网桥)
            - [网桥的定义](#网桥的定义)
            - [网桥的功能](#网桥的功能)
            - [网桥的Q&A](#网桥的qa)
        - [集线器](#集线器)
            - [集线器的定义](#集线器的定义)
            - [集线器的功能](#集线器的功能)
            - [集线器的特殊应用](#集线器的特殊应用)
        - [交换机](#交换机)
            - [交换机的定义](#交换机的定义)
            - [交换机的功能](#交换机的功能)
            - [交换机的分类](#交换机的分类)
            - [网桥-集线器-交换机的区别](#网桥-集线器-交换机的区别)
        - [路由器](#路由器)
            - [路由器的定义](#路由器的定义)
            - [路由器的功能](#路由器的功能)
            - [路由器的分类](#路由器的分类)
            - [路由器的Q&A](#路由器的qa)
        - [网关](#网关)
            - [网关的定义](#网关的定义)
            - [网关的功能](#网关的功能)
            - [网关的Q&A](#网关的qa)
        - [AP](#ap)
        - [AC](#ac)
        - [VPN设备](#vpn设备)
    - [虚拟设备](#虚拟设备)
        - [tun](#tun)
        - [tap](#tap)
        - [vlan](#vlan)
    - [网络安全设备](#网络安全设备)
        - [防火墙](#防火墙)
        - [IDS](#ids)
        - [IPS](#ips)
        - [网络蜜罐](#网络蜜罐)
        - [网络沙箱](#网络沙箱)

<!-- /TOC -->

## 常规网络设备

### 网卡

#### 网卡的定义

网卡，又称网络接口控制器（network interface controller，NIC），网络适配器（network adapter）。是一块被设计用来允许计算机在计算机网络上进行通讯的计算机硬件，它使得用户可以通过电缆（有线网卡）或无线（无线网卡）与互联网或局域网连接，属于OSI模型的第1层（物理层）。

每一个网卡都有一个被称为MAC地址的独一无二的48位串行号，它被写在卡上的一块ROM中。在网络上的每一个计算机都必须拥有一个独一无二的MAC地址，每个网卡厂家往往拥有一段MAC供自己的产品自行分配，因此能够根据MAC地址的前几位，一般是前6位，判断出网卡的生产厂家。

#### 网卡的功能

1. 数据的封装与解封：发送时将上一层交下来的数据加上首部和尾部，成为以太网的帧。接收时将以太网的帧剥去首部和尾部，然后送交上一层

2. 链路管理：主要是CSMA/CD（Carrier Sense Multiple Access with Collision Detection ，带冲突检测的载波监听多路访问）协议的实现

3. 编码与译码：即曼彻斯特编码与译码。

- 附加功能：

    - checksum功能：该功能在【网络适配器】-【属性】-【配置】-【高级】中进行设置。

        - TCP checksum offload: 开/关，表示网卡硬件TCP校验和功能加载和卸载

        - UDP checksum offload：开/关，表示网卡硬件UDP校验和功能加载和卸载

一般高级些的网卡才具备上述checksum offload功能及其开与关，该功能能够在网卡硬件上完成checksum的发送计算和接收校验，降低了CPU的压力。

#### 网卡的Q&A

1. 网卡上的橙色和绿色灯代表什么？

    绿色灯：连接正常指示灯

    橙色灯：数据传输指示灯

---

### 网桥

#### 网桥的定义

网桥，也叫桥接器，是连接两个局域网的一种存储/转发设备，它能将一个大的LAN分割为多个网段，或将两个以上的LAN互联为一个逻辑LAN，使LAN上的所有用户都可访问服务器。从一个网络电缆里接收信号， 放大它们，将其送入下一个电缆。相比较而言，网桥对从关卡上传下来的信息更敏锐一些。网桥是一种对帧进行转发的技术，根据MAC分区块，可隔离碰撞。网桥将网络的多个网段在数据链路层连接起来。

网桥是早期的一个过渡产物，它的功能介于集线器(HUB)和交换机(SWITCH)之间。

有线网桥与无线网桥

1. 有线网桥

将两个或多个(通常为两个)网络线缆(光缆、电缆)进行桥接，实现线缆内信号的放大，转发。

2. 无线网桥

将两个或多个(通常为两个)无线热点进行桥接，实现无线电信号放大、转发，进而扩大范围，好比电磁波的空中交换机。

#### 网桥的功能

1. LAN的分割
2. 不同LAN的连接
3. 数据链路层的连接

#### 网桥的Q&A

虚拟网桥：相对于硬件网桥设备，虚拟网桥是在计算机操作系统中，将两块网卡设置桥接，这个桥接称为虚拟网桥，该网桥的两块网卡所在网段将连接在一起。

**windows下桥接方法：** 

![image](/image/bridge.png)

**linux下桥接的方法：**

```shell
#安装网桥管理软件
apt-get install bridge-util
#创建网桥
brctl addbr br0
#添加网卡
brctl addif br0 enp2s0
brctl addif br0 enp3s0
#查看网桥状态
brctl show

```
[网桥、集线器、交换机的区别](#网桥-集线器-交换机的区别)

### 集线器

#### 集线器的定义
集线器(HUB)，集线器的主要功能是对接收到的信号进行再生整形放大，以扩大网络的传输距离，同时把所有节点集中在以它为中心的节点上。采用CSMA/CD（即带冲突检测的载波监听多路访问技术)介质访问控制机制，它工作在OSI模型的第一层(物理层)。

#### 集线器的功能
集线器每个接口简单的收发比特，收到1就转发1，收到0就转发0，不进行碰撞检测。集线器属于纯硬件网络底层设备，基本上不具有类似于交换机的"智能记忆"能力和"学习"能力。它也不具备交换机所具有的MAC地址表，所以它发送数据时都是没有针对性的，而是采用广播方式发送。也就是说当它要向某节点发送数据时，不是直接把数据发送到目的节点，而是把数据包发送到与集线器相连的所有节点。

#### 集线器的特殊应用
利用能够把数据包发送到与集线器相连的所有节点的特点，集线器通常也用作抓包工具。

构建第一种场景：

某局域网有10台主机，我们需要对所有机器的网络进行监测，部署IDS设备或Wireshark抓包，就需要能够在局域网的中心节点上拿到所有主机的所有网路数据(局域网内和外发至上层网络)，有两中网络设备能够满足我的需求，一个是镜像口交换机，一个是集线器，前者价格几乎是后者的10倍甚至更多，因此在合适的情况下可以采用集线器。

构建第二种场景：

某局域网有10台主机，我们需要对该局域网对外的网络进行监测，即进出该局域网的数据。部署设备或Wireshark抓包，需要在对外链路上串联相应的设备进行数据包的转发，如果是光纤，可使用光分路器，进行抓包。如果是电缆，集线器能够实现数据的复制转发，满足监测或交换机单镜像口翻倍部署多台检测设备的需求，因此在合适的情况下可以采用集线器。

[网桥、集线器、交换机的区别](#网桥-集线器-交换机的区别)

### 交换机

#### 交换机的定义

交换机(Switch)是一种用于电(光)信号转发的网络设备。它可以为接入交换机的任意两个网络节点提供独享的电信号通路。工作在OSI模型的第二层(数据链路层)及以上。
#### 交换机的功能
交换机最基本功能是为接入其端口的任意两个端口间提供虚拟专线连接。主要功能包括物理编址、网络拓扑结构、错误校验、帧序列以及流控。还具备了一些新的功能，如VLAN、链路汇聚，甚至还具有防火墙功能。

**学习功能**

以太网交换机了解每一端口相连设备的MAC地址，并将地址同相应的端口映射起来存放在交换器缓存中的MAC地址表中。

我们在网桥一节中，可以通过设置学习功能的时间控制网桥为交换机模式还是HUB模式
```shell
#设置学习时间
brctl setageing br0 60
#退化为HUB模式
brctl setageing br0 0
```

**转发过滤**

当一个数据帧的目的地址在MAC地址表中有映射时，它被转发到连接目的节点的端口而不是所有端口（如该数据帧为广播/组播帧则转发至所有端口）。若在端口和MAC映射表中不存在该MAC，则广播所有端口，等待特定端口产生回复数据后，更新端口MAC映射表。

**消除回路**

当交换器包括一个冗余回路时，以太网交换器通过生成树协议(STP)避免回路的产生，同时允许存在后备路径。

#### 交换机的分类

交换机分类多种多样，可以按照光电特性、速度、场合、用途而分为不同的种类，这里我们只介绍典型的几种类别的交换机

**两层交换机**

两层交换机，顾名思义其工作拥有OSI两层的工作能力，即物理层和数据链路层。是目前非常成熟的交换机技术，这种交换机能够完成端口和MAC的映射，识别数据包中MAC地址信息，根据MAC地址和端口MAC映射，将数据帧发往特定的端口。

**三层交换机**

三层交换机拥有OSI三层的工作能力，在传统两层交换机的基础上，增加了网络层的相关功能。具体体现在对网络数据包中IP进行了识别，能够实现不同子网间数据包的转发。

**四层交换机**

四层交换机拥有OSI四层的工作能力，在三层交换机的基础上，增加了传输层的相关功能。具体体现在对网路数据包中TCP/UDP的端口进行了识别。

**硬件交换机**

硬件交换机是指具有交换机外观，内部具有交换机电路，交换机芯片的，实现交换机功能的硬件设备。

**软件交换机**

软件交换机是指在PC机或ARM版上(非交换机专用芯片平台)，通过纯软件的方式，建立虚拟连接，实现数据转发。常见软件交换技术方案有：

1. [OpenVSwitch](http://www.openvswitch.org/)
2. [vSphere](https://www.vmware.com/cn/products/vsphere.html)
3. [SONiC P4](https://github.com/Azure/SONiC/wiki/SONiC-P4-Software-Switch)

软交换技术的优劣：

优势：高度可控可编程，可以很容易的实现端口管理，且工作在虚拟化、云场景下可以低成本部署，管理，甚至二次开发。

劣势：同等成本情况下，性能配置不及硬件交换机，无硬件加速，依赖运行平台的综合参数。

软交换的应用：虚拟化、公有云

#### 网桥-集线器-交换机的区别

|设备类型|背板总线|交换通道|转发延时|带宽|OSI层|备注|
|--|--|--|--|--|--|--|
|网桥|多条|各端口独立拥有|大|高|1、2层|有目的转发|
|集线器|一条|一条|大|小|1层|无目的广播|
|交换机|多条|各端口独立拥有|小|大|1、2(3、4)层|有目的转发|

当节点A向节点D发送数据时，节点B可同时向节点C发送数据，而且这两个传输都享有网络的全部带宽，都有着自己的虚拟连接。假使这里使用的是10Mbps的以太网交换机，那么该交换机这时的总流通量就等于2×10Mbps=20Mbps，而使用10Mbps的共享式集线器时，一个集线器的总流通量也不会超出10Mbps。

### 路由器

#### 路由器的定义

**路由：**
路由是指分组从源到目的地时，决定端到端路径的网络范围的进程.

**路由器：**
路由器在网路层实现网间互联，它可以实现同类型或不同类型的网络互连，包括LAN与LAN，LAN与WAN，WAN与WAN的互连。其实是一个具有多个输入端口和多个输出端口的专用计算机，其功能是转发分组，它把从某一输入端口收到的分组按照分组所携带的目的地之从适当的输出端口转发出去。


#### 路由器的功能

主要功能是路由选择，这是通过

核心功能NAT

1. 端口转发：

如果一个WAN口的主机，需要**主动**连接LAN口的主机IP:Port，（例如：想在LAN口架设一台服务器，WAN口要请求服务器），怎么能够实现呢？

将一个WAN口Port与LAN口主机IP:Port设置为转发链路，类似静态路由，此时WAN口主机向路由器WAN口IP:Port发送数据，路由器发在该包头信息存在于端口转发表中，于是将该数据包按照目的为LAN口的IP:Port的规则进行NAT转换，则该包会发往LAN口主机的IP:Port上。

2. DMZ

3. DDNS：动态域名解析

#### 路由器的分类

按信号的发送方式分类：有线路由器、无线路由器

按用途分类：企业级路由器、家用路由器

按固件类型分类：开源路由器、闭源路由器

按智能性分类：智能路由器、非智能路由器

智能路由器开源操作系统

1. [OpenWRT(LEDE)](https://openwrt.org/)
2. [DD-WRT](https://dd-wrt.com/)
3. [Tomato-WRT](http://www.polarcloud.com/tomato)

#### 路由器的Q&A

1. 哪些设备具有路由器的功能：
    - 防火墙
    - 路由器
    - L3\L4层交换机

2. 高带机量的实验室、宾馆、教室的**低成本**解决方案：

    - 软路由+胖AP

    - 软路由+AC+瘦AP

### 网关

#### 网关的定义

#### 网关的功能

#### 网关的Q&A

1. 哪些设备具有网关的功能：
    - 防火墙
    - 路由器

### AP

无线接入点(Access Piont)，将有线网络转换成无线网络，是无线网和有线网之间沟通的桥梁。

**与无线网桥的区别**

通过无线传输方式实现在两个或多个网络之间进行通信的桥梁，无线网桥产品定位于远距离无线传输数据，因此其天线通常是定向的，传输距离远大于无线AP。网桥除了可以将两个无线网络桥接外，还可以将有线网络与无线网络连接。

### AC

### VPN设备

## 虚拟设备

### tun

### tap

### vlan

设置VLAN的最主要设备：交换机

## 网络安全设备

### 防火墙

### IDS

### IPS

### 网络蜜罐

### 网络沙箱

